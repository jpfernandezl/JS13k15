M=Math;a="";c=$.getContext("2d");e=0;f=[];for(i=0;300>i;i++)f[i]=[1200*M.random(),650*M.random(),M.random()+.5];o=n=m=0;r=q=3E4;t=[];u=[];v=[];w=[];A=[];B=[];C=[];E=[];F=[];G=[];T=S=R=N=I=J=K=0;
with(new XMLHttpRequest)open("GET",0),responseType="arraybuffer",send(),onload=function(){a=String.fromCharCode.apply(!1,new Uint8Array(response)).split("\u00fe");for(i=0;i<a.length-1;i+=2)Z=[a[i].split(",")[0],a[i].split(",")[1],a[i+1].slice(0,-2).split("\u00ff"),a[i+1].slice(-2)],398>i&&t.push(Z),152>i?(u.push(Z),A.push(Z)):246>i?(v.push(Z),B.push(Z)):394>i?(w.push(Z),C.push(Z)):468>i?E.push(Z):536>i?F.push(Z):596>i&&G.push(Z);X=function(){return.5-M.random()};u.sort(X);v.sort(X);w.sort(X);A.sort(X);
B.sort(X);C.sort(X);E.sort(X);f.sort(X);G.sort(X);s=setInterval(function(){$.width^=0;0==e&&(d(0),c.fillStyle="#fff",c.font="300px Impact, Charcoal",c.fillText("GE",30,375,300),c.fillText("Quiz",620,375,500),c.font="30px Impact, Charcoal",c.fillText("JS13kGames 2015",900,405),c.font="80px Impact, Charcoal",c.fillText("START",500,570));1==e&&H();2==e&&(0==m&&d(1,0,0,n),1==m&&d(1,1,0,n),2==m&&d(1,2,0,n),3==m&&d(1,0,1,n),4==m&&d(1,1,1,n),5==m&&d(1,2,1,n))},33)};
d=function(b,g,l,z){$.style.background=b?"radial-gradient(#75D1FF 50%, #3591bF)":"#000";if(b)c.rect(0,0,1200,66),c.fill(),c.beginPath(),c.fillStyle="#fff",c.rect(0,60,4*h,5),c.fill(),c.font="40px Impact, Charcoal",c.fillText(["Country: ","Capitol: ","Place: "][g]+[[u,v,w],[A,B,C],[E,F,G]][g][l][z][[0,1,0][g]],10,45),c.textAlign="right",c.fillText(r+"km remaining",1190,45);else{T+=1;T%=220;S--;S%=1200;for(i=0;300>i;i++)c.fillStyle="#fff",c.beginPath(),c.arc(X=f[i][0]+S,Y=f[i][1],Z=f[i][2]+.5*M.random(),
0,7),c.arc(1200+X,Y,Z,0,7),c.fill();c.beginPath();gradient=c.createLinearGradient(300,0,600,0);gradient.addColorStop(0,"#75D1FF");gradient.addColorStop(1,"#3591bF");c.fillStyle=gradient;c.arc(470,260,140,0,7);c.fill()}c.strokeStyle="#83864F";c.fillStyle="#95D866";if(85>o)for(i=0;i<t.length;i++)for(P=t[i][2],j=0;j<P.length;j++){O=P[j];c.beginPath();if(b)for(k=0;k<O.length;k+=2)x=O.charCodeAt(k),y=O.charCodeAt(k+1),c.lineTo(4.6*x+40,2.3*y+70);else for(k=0;k<O.length;k+=2){x=(O.charCodeAt(k)+220-T)/
110;for(y=-(O.charCodeAt(k+1)-120)/150;1<x;)x-=2;-1<x&&-.5>x&&(x=-.5);.5<x&&1>x&&(x=.5);k||"Russia"==t[i][0]||"Canada"==t[i][0]||(0>x&&(N=-.5),0<x&&(N=.5));"Russia"==t[i][0]&&(N=-.5,70<T&&(N=.5),170<T&&(N=-.5));"Canada"==t[i][0]&&(N=.5,40<T&&(N=-.5),140<T&&(N=.5));if(-.5>=x||.5<=x)x=N;x=M.sin(x*M.PI)*M.cos(y*M.PI/2);y=M.sin(-y*M.PI/2);x=140*x+470;y=140*y+260;c.lineTo(x,y)}c.closePath();c.fill();c.stroke()}if(b){if(I||J){P=[[u,v,w],[A,B,C],[E,F,G]][g][l][z][2];Q=[[u,v,w],[A,B,C],[E,F,G]][g][l][z][3];
log(Q);for(j=0;j<P.length;j++){O=P[j];c.fillStyle="yellow";c.beginPath();for(k=0;k<O.length;k+=2)x=O.charCodeAt(k),y=O.charCodeAt(k+1),c.lineTo(4.6*x+40,2.3*y+70),X=M.sqrt(M.pow(4.6*x+40-I,2)+M.pow(2.3*y+70-J,2)),X<q&&(q=X,p=[4.6*x+40,2.3*y+70]);c.closePath();c.fill();c.stroke();1!=g?c.isPointInPath(I,J)?K=1:(15==o&&(r-=100>q?100*~~(q/5):1E3*~~(q/50)),0>r&&(r=0,log("game over"))):(x=Q.charCodeAt(0),y=Q.charCodeAt(1),p=[4.6*x+40,2.3*y+70],q=M.sqrt(M.pow(4.6*x+40-I,2)+M.pow(2.3*y+70-J,2)))}!K&&5<q&&
(c.fillStyle="green",c.strokeStyle="green",c.beginPath(),c.moveTo(p[0],p[1]),c.lineTo(p[0]-1,p[1]),c.lineTo(p[0]-1,p[1]-40),c.lineTo(p[0],p[1]-40),c.lineTo(p[0]+20,p[1]-30),c.lineTo(p[0],p[1]-20),c.stroke(),c.fill(),c.strokeStyle="red",c.lineWidth="2",c.setLineDash([5,5]),c.beginPath(),c.moveTo(I,J),c.lineTo(p[0],p[1]),c.stroke());c.setLineDash([0,0]);c.fillStyle="blue";c.strokeStyle="blue";c.beginPath();c.moveTo(I,J);c.lineTo(I-1,J);c.lineTo(I-1,J-40);c.lineTo(I,J-40);c.lineTo(I+20,J-30);c.lineTo(I,
J-20);c.stroke();c.fill();o++;15<o&&(c.textAlign="center",c.fillStyle="#000",c.font="100px Impact, Charcoal",K||3>q?c.fillText("PERFECT",600,350):(c.fillText(["NICE!","GOOD...","MEH.","OWW...","NOOO!"][~~(q/30)]||"WRONG!",600,350),c.font="50px Impact, Charcoal",c.fillText("You're "+(100>q?100*~~(q/5):1E3*~~(q/50))+"km away",600,400)))}0==h&&(c.textAlign="center",o++,c.fillStyle="#000",c.font="100px Impact, Charcoal",c.fillText("TIME OUT",600,350),c.font="50px Impact, Charcoal",c.fillText("10,000km penalty",
600,400));o||h--;85<o&&(c.fillStyle="#000",c.fillRect(0,0,1200,650));90==o&&(n++,K=o=J=I=0,h=300,q=2E3,10==n&&(n=0,e=1,R+=r,r=3E4,m++,9==m&&log("game over. score: "+R)))}};H=function(){$.style.background="#000";c.fillStyle="#fff";c.font="60px Impact, Charcoal";c.textAlign="center";c.fillText("Level "+(m+1)+":",600,280,800);c.fillText(["World Countries (easy)","Capitols (easy)"][m],600,360,800)};$.onclick=function(b){0==e?e=1:1==e?(e=2,h=300):2!=e||o||(I=b.pageX,J=b.pageY)};log=function(b){console.log(b)}